name: Wallet Doctor (daily, verbose)

on:
  schedule:
    # Runs daily at 02:00 IST â†’ 20:30 UTC previous day
    - cron: "30 20 * * *"
  workflow_dispatch:

jobs:
  run-wallet-doctor-verbose:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Install Dependencies
        run: npm ci

      - name: Debug / Environment info
        run: |
          echo "---- runner info ----"
          uname -a
          echo "---- node / npm versions ----"
          node -v
          npm -v
          echo "---- repo root listing ----"
          ls -al
          echo "---- scripts folder listing ----"
          ls -al ./scripts || true

      - name: Run walletDoctor (verbose)
        env:
          MONGO_URI: ${{ secrets.MONGO_URI }}
        run: |
          echo "Starting walletDoctor at $(date -u +'%Y-%m-%dT%H:%M:%SZ')"
          node ./scripts/walletDoctor.js
          echo "Finished walletDoctor at $(date -u +'%Y-%m-%dT%H:%M:%SZ')"
